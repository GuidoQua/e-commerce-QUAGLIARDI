

/**********************************
***********************************
    MI ARRAY
        DE
    PRODUCTOS
************************************
************************************/

let productos = [

    /******************** 
    
    === ZAPATILLAS ===

    ********************/

    {
        id: "zapatilla-01",
        titulo: "Nike Zoom Freak 3 'Crimson Bliss'",
        imagen: "./img/nike/nike-01-1.png",
        precio: "59320",
        marca: "Nike",
        categoria: {
            nombre: "Calzado",
            producto: "zapatillas",
        },
    },

    {
        id: "zapatilla-02",
        titulo: "Nike Precision 6 'Iron Grey'",
        imagen: "./img/nike/nike-02-1.png",
        precio: "50420",
        marca: "Nike",
        categoria: {
            nombre: "Calzado",
            producto: "zapatillas",
        },
    },

    {
        id: "zapatilla-03",
        titulo: "Nike Zoom Freak 4 'Greek Coastline'",
        imagen: "./img/nike/nike-03-1.png",
        precio: "62405",
        marca: "Nike",
        categoria: {
            nombre: "Calzado",
            producto: "zapatillas",
        },
    },

    {
        id: "zapatilla-04",
        titulo: "Nike Kyrie 6 - TB Black",
        imagen: "./img/nike/nike-04-1.png",
        precio: "57900",
        marca: "Nike",
        categoria: {
            nombre: "Calzado",
            producto: "zapatillas",
        },
    },

    {
        id: "zapatilla-05",
        titulo: "Luka 1 'Next Nature'",
        imagen: "./img/jordan/jordan-01-1.webp",
        precio: "67200",
        marca: "Jordan",
        categoria: {
            nombre: "Calzado",
            producto: "zapatillas",
        },
    },

    {
        id: "zapatilla-06",
        titulo: "Air Jordan XXXVII Satou",
        imagen: "./img/jordan/jordan-02-1.jpg",
        precio: "55500",
        marca: "Jordan",
        categoria: {
            nombre: "Calzado",
            producto: "zapatillas",
        },
    },

    {
        id: "zapatilla-07",
        titulo: "Air Jordan XXXVII Low",
        imagen: "./img/jordan/jordan-03-1.webp",
        precio: "46150",
        marca: "Jordan",
        categoria: {
            nombre: "Calzado",
            producto: "zapatillas",
        },
    },

    {
        id: "zapatilla-08",
        titulo: "Air Jordan XXXVI Low",
        imagen: "./img/jordan/jordan-04-1.webp",
        precio: "63170",
        marca: "Jordan",
        categoria: {
            nombre: "Calzado",
            producto: "zapatillas",
        },
    },

    {
        id: "zapatilla-09",
        titulo: "Under Armour Buzzer 'Electrical'",
        imagen: "./img/under_armour/under_armour-01-1.jpg",
        precio: "58250",
        marca: "Under Armour",
        categoria: {
            nombre: "Calzado",
            producto: "zapatillas",
        },
    },

    {
        id: "zapatilla-10",
        titulo: "Under Armour Spawn 3 'Black Beta'",
        imagen: "./img/under_armour/under_armour-02-1.png",
        precio: "54860",
        marca: "Under Armour",
        categoria: {
            nombre: "Calzado",
            producto: "zapatillas",
        },
    },

    {
        id: "zapatilla-11",
        titulo: "Under Armour Curry 3Zer0 3 'Grey Gravity Green'",
        imagen: "./img/under_armour/under_armour-03-1.webp",
        precio: "41358",
        marca: "Under Armour",
        categoria: {
            nombre: "Calzado",
            producto: "zapatillas",
        },
    },

    {
        id: "zapatilla-12",
        titulo: "Under Armour Spawn 3 'Electric Blue'",
        imagen: "./img/under_armour/under_armour-04-1.png",
        precio: "54860",
        marca: "Under Armour",
        categoria: {
            nombre: "Calzado",
            producto: "zapatillas",
        },
    },

    {
        id: "zapatilla-13",
        titulo: "Adidas DON Issue 3 'Christmas'",
        imagen: "./img/adidas/adidas-01-1.png",
        precio: "62180",
        marca: "Adidas",
        categoria: {
            nombre: "Calzado",
            producto: "zapatillas",
        },
    },

    {
        id: "zapatilla-14",
        titulo: "Adidas Harden Stepback 2 'Aqua'",
        imagen: "./img/adidas/adidas-02-1.png",
        precio: "48170",
        marca: "Adidas",
        categoria: {
            nombre: "Calzado",
            producto: "zapatillas",
        },
    },

    {
        id: "zapatilla-15",
        titulo: "Adidas DON Issue 2 Crayola 'Solar Gold'",
        imagen: "./img/adidas/adidas-03-1.png",
        precio: "60000",
        marca: "Adidas",
        categoria: {
            nombre: "Calzado",
            producto: "zapatillas",
        },
    },

    {
        id: "zapatilla-16",
        titulo: "Adidas Harden Vol.5 Futurenatural 'CNY'",
        imagen: "./img/adidas/adidas-04-1.png",
        precio: "54550",
        marca: "Adidas",
        categoria: {
            nombre: "Calzado",
            producto: "zapatillas",
        },
    },

    /******************** 
    
    === INDUMENTARIA ===

    ********************/

    // === CAMISETAS ===
    {
        id: "indumentaria-01",
        titulo: "Camiseta 'Classic'",
        imagen: "./img/indumentaria-jordan-01-1.jpg",
        precio: "7800",
        marca: "Jordan",
        categoria: {
            nombre: "Indumentaria",
            producto: "camisetas, remeras",
        },
    },

    {
        id: "indumentaria-02",
        titulo: "Camiseta Nike 'Golden'",
        imagen: "./img/indumentaria-nike-02-1.jpg",
        precio: "8800",
        marca: "Nike",
        categoria: {
            nombre: "Indumentaria",
            producto: "camisetas, remeras",
        },
    },

    {
        id: "indumentaria-03",
        titulo: "Camiseta Nike 'Lakers'",
        imagen: "./img/indumentaria-nike-03-1.webp",
        precio: "9250",
        marca: "Nike",
        categoria: {
            nombre: "Indumentaria",
            producto: "camisetas, remeras",
        },
    },

    {
        id: "indumentaria-04",
        titulo: "Camiseta Nike 'Brooklyn'",
        imagen: "./img/indumentaria-nike-04-1.webp",
        precio: "9250",
        marca: "Nike",
        categoria: {
            nombre: "Indumentaria",
            producto: "camisetas, remeras",
        },
    },

    // === BUZOS ===
    {
        id: "indumentaria-05",
        titulo: "Buzo Canguro 'Lakers'",
        imagen: "./img/indumentaria-nike-05-1.jpg",
        precio: "24320",
        marca: "Nike",
        categoria: {
            nombre: "Indumentaria",
            producto: "buzos canguros",
        },
    },

    {
        id: "indumentaria-06",
        titulo: "Buzo Canguro 'NBA'",
        imagen: "./img/indumentaria-nike-06-1.jpg",
        precio: "22420",
        marca: "Nike",
        categoria: {
            nombre: "Indumentaria",
            producto: "buzos canguros",
        },
    },

    {
        id: "indumentaria-07",
        titulo: "Buzo Canguro 'Bulls'",
        imagen: "./img/indumentaria-nike-07-1.webp",
        precio: "24320",
        marca: "Nike",
        categoria: {
            nombre: "Indumentaria",
            producto: "buzos canguros",
        },
    },

    {
        id: "indumentaria-08",
        titulo: "Buzo Canguro 'Suns'",
        imagen: "./img/indumentaria-nike-08-1.jpg",
        precio: "24320",
        marca: "Nike",
        categoria: {
            nombre: "Indumentaria",
            producto: "buzos canguros",
        },
    },

    //=== PANTALONES ===

    {
        id: "indumentaria-09",
        titulo: "Pantalón Largo 'Bulls'",
        imagen: "./img/indumentaria-nike-09-1.webp",
        precio: "19250",
        marca: "Nike",
        categoria: {
            nombre: "Indumentaria",
            producto: "pantalones largos",
        },
    },

    {
        id: "indumentaria-10",
        titulo: "Pantalón Largo 'Lakers'",
        imagen: "./img/indumentaria-nike-10-1.webp",
        precio: "19250",
        marca: "Nike",
        categoria: {
            nombre: "Indumentaria",
            producto: "pantalones largos",
        },
    },

    {
        id: "indumentaria-11",
        titulo: "Pantalón Largo 'Wizards'",
        imagen: "./img/indumentaria-nike-11-1.webp",
        precio: "19250",
        marca: "Nike",
        categoria: {
            nombre: "Indumentaria",
            producto: "pantalones largos",
        },
    },

    {
        id: "indumentaria-12",
        titulo: "Pantalón Largo 'Brooklyn'",
        imagen: "./img/indumentaria-nike-12-1.webp",
        precio: "19250",
        marca: "Nike",
        categoria: {
            nombre: "Indumentaria",
            producto: "pantalones largos",
        },
    },

        /******************** 
    
    === ACCESORIOS ===

    ********************/

    {
        id: "accesorios-01",
        titulo: "Mochila Jordan 'Classic'",
        imagen: "./img/accesorios-mochila-01-1.jpg",
        precio: "29670",
        marca: "Jordan",
        categoria: {
            nombre: "Accesorios",
            producto: "mochilas",
        },
    },

    {
        id: "accesorios-02",
        titulo: "Mochila Jordan 'Power USA'",
        imagen: "./img/accesorios-mochila-02-1.webp",
        precio: "48280",
        marca: "Jordan",
        categoria: {
            nombre: "Accesorios",
            producto: "mochilas",
        },
    },

    {
        id: "accesorios-03",
        titulo: "Medias Jordan - Pack Three",
        imagen: "./img/accesorios-medias-03-1.webp",
        precio: "6405",
        marca: "Jordan",
        categoria: {
            nombre: "Accesorios",
            producto: "medias",
        },
    },

    {
        id: "accesorios-04",
        titulo: "Gorra Jordan 'Red Power'",
        imagen: "./img/accesorios-gorra-04-1.jpg",
        precio: "8255",
        marca: "Jordan",
        categoria: {
            nombre: "Accesorios",
            producto: "gorras",
        },
    },

    {
        id: "accesorios-05",
        titulo: "Pelota Molten - BG4500 N7",
        imagen: "./img/accesorios-pelota-05-1.jpg",
        precio: "45720",
        marca: "Molten",
        categoria: {
            nombre: "Accesorios",
            producto: "pelotas",
        },
    },

    {
        id: "accesorios-06",
        titulo: "Pelota Molten - GR5X 'Blue'",
        imagen: "./img/accesorios-pelota-06-1.jpg",
        precio: "14910",
        marca: "Molten",
        categoria: {
            nombre: "Accesorios",
            producto: "pelotas",
        },
    },

    {
        id: "accesorios-07",
        titulo: "Pelota Adidas N7 'Classic'",
        imagen: "./img/accesorios-pelota-07-1.jpg",
        precio: "38346",
        marca: "Adidas",
        categoria: {
            nombre: "Accesorios",
            producto: "pelotas",
        },
    },

    {
        id: "accesorios-08",
        titulo: "Carpeta Spalding 'NBA'",
        imagen: "./img/accesorios-carpeta-08-1.jpg",
        precio: "7200",
        marca: "Spalding",
        categoria: {
            nombre: "Accesorios",
            producto: "carpetas",
        },
    },

];


//Carrito vacio

let carrito = [];


//Declaración del título general

const titulos = document.querySelector(".contenedor-titulos");
titulos.innerText = "Todos los Productos";


/**************************************
***************************************

FUNCION CARGAR PRODUCTOS

***************************************
***************************************/

const contenedorProductos = document.querySelector("#contenedor-productos");


function cargarProductos(productos) {

    contenedorProductos.innerHTML = "";

    productos.forEach(producto => {

        const div = document.createElement("div");
        div.innerHTML= `
                    <div class="contenedor-card">
                        <div class="contenedor-card-imagen">
                            <img class="imagen" src="${producto.imagen}" alt="${producto.titulo}">
                        </div>
                        <div class="contenedor-card-informacion">
                            <h3 class="titulo mb-2">${producto.titulo}</h3>
                            <div class="precio mb-2">$${producto.precio}</div>
                            <button type="button" class="btn btn-dark agregar-carrito" data-id="${producto.id}"><i class="bi bi-bag-fill"></i> AGREGAR</button>
                        </div>
                    </div>
                
        `;

        contenedorProductos.append(div);
    });
};

cargarProductos(productos);



/**************************************
***************************************

FUNCION BUSCAR PRODUCTOS

***************************************
***************************************/

const botonBuscar = document.querySelector(".btn__mio");


botonBuscar.addEventListener("click", function(e) {
    e.preventDefault();

    const buscar = document.querySelector("#buscarProducto");
    const productoBuscado = buscar.value.toLowerCase();

    const resultados = productos.filter(function(producto) {
    return (producto.titulo.toLowerCase().includes(productoBuscado) || producto.categoria.nombre.toLowerCase().includes(productoBuscado) || producto.categoria.producto.toLowerCase().includes(productoBuscado));
    });

    titulos.innerText = "Resultados de la búsqueda"; //Cambio de título

    if (resultados.length > 0) {
        cargarProductos(resultados); //Reutilizo la función cargarProductos cambiando el parámetro
    } else {
        contenedorProductos.innerHTML = 
                                    `<div class="contenedor__busquedad">
                                        <p class="text-center pt-3">No se encontró "<b>${productoBuscado}</b>"</p>
                                    </div>`;
    }

});


/**************************************
***************************************

    FUNCION AGREGAR AL CARRITO 
        CON LOCAL STORAGE

***************************************
***************************************/

function agregarAlCarrito(e) {
    if (e.target.classList.contains("agregar-carrito")) {
        const productoId = e.target.dataset.id;
        const producto = productos.find((p) => p.id === productoId);

        if (producto) {
        const productoEnCarrito = carrito.find((p) => p.id === productoId);

        if (productoEnCarrito) {
          // Si ya tengo el producto subo la cantidad y sumar el precio
            productoEnCarrito.cantidad++;
            productoEnCarrito.precioTotal = productoEnCarrito.precio * productoEnCarrito.cantidad;
        } else {
          // Si no tengo el producto en el carrito suma cantidad 1 y el precio normal
            producto.cantidad = 1;
            producto.precioTotal = producto.precio;
            carrito.push(producto);
        }

        guardarCarritoLS();
        mostrarCarrito();
        actualizarCantidadCarrito();
        }
    }
}

  // Función para guardar el carrito en el Local Storage
function guardarCarritoLS() {
    localStorage.setItem("carrito", JSON.stringify(carrito));
}

// Función para trae el carrito del Local Storage
function TraerCarritoLS() {
    const carritoJS = localStorage.getItem("carrito");
    return carritoJS ? JSON.parse(carritoJS) : [];
}

// Cargo el carrito desde el Local Storage
carrito = TraerCarritoLS();
mostrarCarrito();
actualizarCantidadCarrito();

contenedorProductos.addEventListener("click", agregarAlCarrito);


/**************************************
***************************************

        MOSTRAR CARRITO 

***************************************
***************************************/

function mostrarCarrito() {
    const contenedorCarrito = document.getElementById("contenedor-carrito");

    if (carrito.length === 0) {
        contenedorCarrito.innerHTML = `
                                    <div class="carrito__vacio">
                                    <p> Su carrito esta vacío </p>
                                    <a href="#buscarProducto"><button type="button" class="btn btn-dark btn-lg p-2">Ir a comprar</button></a>
                                    </div>`
    } else {
        contenedorCarrito.innerHTML = "";

        // Creo los productos del carrito
        carrito.forEach((producto) => {
            const mostrarProductos = document.createElement("div");
            mostrarProductos.innerHTML = `
                                    <div class="producto-carrito">
                                    <img class= "imagen-carrito" src="${producto.imagen}" alt="${producto.titulo}">
                                    <h4 class="m-0 p-1">${producto.titulo}</h4>
                                    <p class="m-0 p-1">Precio: $${producto.precio}</p>
                                    <p class="m-0 p-1">Cantidad: ${producto.cantidad}</p>
                                    <p class="m-0 p-1">Subtotal: $${producto.precioTotal}</p>
                                    <button type="button" class="botones__carrito" data-id="${producto.id}"><i class="bi bi-trash3"></i></button>
                                    </div>`;
                                    
          contenedorCarrito.append(mostrarProductos); // Agregar los productos al carrito

            calcularTotal();

            // Evento para eliminar un producto del carrito
            const botonesEliminar = document.querySelectorAll(".botones__carrito");
            botonesEliminar.forEach((btn) => {
            btn.addEventListener("click", eliminarProducto);
            });
        });
    }
}

/**************************************
***************************************

        VACIAR CARRITO  

***************************************
***************************************/

const contenedorVaciar = document.getElementById("contenedor-vaciar");
contenedorVaciar.innerHTML = `
                        <button type="button" class="btn-vaciar btn btn-dark btn-lg p-2">Vaciar Carrito</button>`;

contenedorVaciar.addEventListener("click", vaciarCarrito);

function vaciarCarrito() {
    carrito = []; 
    guardarCarritoLS(); 
    mostrarCarrito(); 
    calcularTotal();
    actualizarCantidadCarrito();
}

/**************************************
***************************************

        FUNCION TOTAL CARRITO 

***************************************
***************************************/

function calcularTotal() {
    const total = carrito.reduce((accum, producto) => {
        return accum + producto.precio * producto.cantidad;
        }, 0);

        const contenedorTotal = document.getElementById("total-carrito");

        if (total > 0) {
            contenedorTotal.innerHTML = `
            <p class="text-end me-5"><span class="st__total">Total: $${total}</span></p>`;
        } else {
            contenedorTotal.innerHTML = "";
        }
}


/**************************************
***************************************

        FUNCION ELIMINAR

***************************************
***************************************/

function eliminarProducto(e) {
    const productoId = e.currentTarget.dataset.id;
    const productoEnCarrito = carrito.find((p) => p.id == productoId);
    if (productoEnCarrito) {
    if (productoEnCarrito.cantidad > 1) {
        productoEnCarrito.cantidad--;
        productoEnCarrito.precioTotal = productoEnCarrito.precio * productoEnCarrito.cantidad;
    } else {
        const index = carrito.indexOf(productoEnCarrito);
        carrito.splice(index, 1);
    }

    guardarCarritoLS();
    mostrarCarrito();
    calcularTotal();
    actualizarCantidadCarrito();
    }
}


/**************************************
***************************************

        FILTRAR POR CATEGORIA

***************************************
***************************************/

const botonesCategorias = document.querySelectorAll(".botones-categorias");

botonesCategorias.forEach(boton =>{
    boton.addEventListener("click", (e) =>{
        const productosCategorias = productos.filter(producto => producto.categoria.nombre === e.currentTarget.id);
        cargarProductos(productosCategorias);
        const titulosCategorias = productos.find(producto => producto.categoria.nombre === e.currentTarget.id);
        titulos.innerText = titulosCategorias.categoria.nombre;
    });
});


//Actualizar numero carrito

function actualizarCantidadCarrito() {
    const numeroCarrito = document.getElementById("numero-carrito");
    let numeroTotalCarrito = 0;

    carrito.forEach((producto) => {
        numeroTotalCarrito += producto.cantidad;
    });

    if (numeroTotalCarrito > 0) {
        numeroCarrito.innerHTML = `<span class="numerito">${numeroTotalCarrito.toString()}</span></div>`;
    } else {
        numeroCarrito.innerHTML = "";
    }
}
